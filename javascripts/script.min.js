function cl(a){console.log(a)}var entuURL="https://ylikool.entu.ee/api2/";angular.module("ylikoolApp",["ngRoute"]).config(["$routeProvider","$sceDelegateProvider",function(a,b){a.when("/ajatelg",{templateUrl:"pages/history.html",controller:"listCtrl"}).when("/konelejad",{templateUrl:"pages/authors.html",controller:"listCtrl"}).when("/teemad",{templateUrl:"pages/subjects.html",controller:"listCtrl"}).when("/:id",{templateUrl:"pages/lecture.html",controller:"lectureCtrl"}).otherwise({redirectTo:"/ajatelg"}),b.resourceUrlWhitelist(["self","http://heli.er.ee/**"])}]).controller("mainCtrl",["$rootScope","$scope","$location",function(a,b,c){a.url=c.path().replace("/",""),b.nightTipNr=Math.floor(3*Math.random()+1),b.pages=[{url:"ajatelg",title:"Ajatelg"},{url:"konelejad",title:"K\xf5nelejad"},{url:"teemad",title:"Teemad"}],b.nightToggle=function(){b.nightMode=!b.nightMode,b.hideNightTip=!0}}]).service("lectureModel",["$rootScope","$http","$window",function(b,c,d){b.lectures||(b.lectures=[]),b.years||(b.years=[]),b.authors||(b.authors=[]),b.subjects||(b.subjects=[]),b.formatLecture=function(b){try{var c=b.properties.kuupaev.values[0].value}catch(d){var c=""}try{var f=b.properties.kirjeldus.values[0].value}catch(d){var f=""}try{var g=b.properties.nimi.values[0].value}catch(d){var g=""}try{var h=b.properties.teema.values}catch(d){var h=[]}try{var i=b.properties.esitaja.values}catch(d){var i=[]}try{var j=b.properties.toimetaja.values}catch(d){var j=[]}try{var k=b.properties.muusika.values}catch(d){var k=[]}try{var l=b.properties.heli.values}catch(d){var l=[]}try{var n=b.properties.teised.values}catch(d){var n=[]}try{var p=b.properties.link.values[0].value}catch(d){var p=""}var q=[];for(u in h)q.push(h[u].value);var r=[];for(a in i)r.push(i[a].value);var t=[];for(e in j)t.push(j[e].value);var v=[];for(m in k)v.push(k[m].value);var w=[];for(s in l)w.push(l[s].value);var x=[];for(o in n)x.push(n[o].value);return{id:b.id,changed:b.changed,description:f,date:c,year:c.substring(0,4),title:g,subject:q.sort(),author:r.sort(),editor:t.sort(),music:v.sort(),sound:w.sort(),other:x.sort(),link:p}},b.pushLectureToScope=function(c,d){if(d)b.lecture=c;else{b.lecture=null,b.lectures.push(c),b.lectures_loaded+=1,-1==b.years.indexOf(c.year)&&(b.years.push(c.year),b.years=b.years.sort(),b.years=b.years.reverse());for(a in c.author)-1==b.authors.indexOf(c.author[a])&&(b.authors.push(c.author[a]),b.authors=b.authors.sort());for(s in c.subject)-1==b.subjects.indexOf(c.subject[s])&&(b.subjects.push(c.subject[s]),b.subjects=b.subjects.sort())}},b.getLecture=function(a,e,f){try{var g=JSON.parse(d.localStorage.getItem("lecture-"+a))}catch(h){var g={changed:""}}if(!g)var g={changed:""};return g.changed==e?(b.pushLectureToScope(g,f),g):(cl("Get lecture #"+a+" from Entu"),c({method:"GET",url:entuURL+"entity-"+a}).success(function(c){return g=b.formatLecture(c.result),d.localStorage.setItem("lecture-"+a,JSON.stringify(g)),b.pushLectureToScope(g,f),g}),void 0)},b.getLectures=function(){c({method:"GET",url:entuURL+"entity",params:{definition:"loeng"}}).success(function(a){b.lectures_count=a.result.length,b.lectures_loaded=0,b.lectures=[],b.years=[],b.authors=[],b.subjects=[];for(i in a.result)b.getLecture(a.result[i].id,a.result[i].changed.dt)})}}]).controller("listCtrl",["$rootScope","$scope","$http","$location","lectureModel",function(a,b,c,d){a.url=d.path().replace("/",""),a.lectures.length<1&&a.getLectures()}]).controller("lectureCtrl",["$rootScope","$scope","$http","$routeParams","lectureModel",function(a,b,c,d){a.url=d.id,a.getLecture(d.id,!1,!0),b.palyAudio=function(b){a.current_lecture=b}}]);
